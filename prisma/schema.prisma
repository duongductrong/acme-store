// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id                String            @id @default(cuid()) @db.Text()
  productName       String
  slug              String            @unique
  SKU               String            @unique
  price             Int
  quantity          Int
  stockAvailability Boolean?          @default(true)
  media             String[]
  thumbnail         String
  description       String
  content           String?
  status            Status            @default(Enabled)
  visibility        ProductVisibility @default(Visible)

  metadata   ProductMetadata? @relation(fields: [metadataId], references: [id])
  metadataId String?          @db.Uuid

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  category   Category? @relation(fields: [categoryId], references: [id])
  categoryId String?   @db.Text

  orders OrderProduct[]

  @@index([id])
  @@map("products")
}

model ProductMetadata {
  id String @id @default(cuid()) @db.Uuid

  metaSeoTitle    String?
  metaSeoKeyword  String?
  metaDescription String?

  Product Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  @@index([id])
  @@map("product_metadatas")
}

enum Status {
  Enabled
  Disabled
}

enum ProductVisibility {
  Visible
  NotVisible
}

enum ProductStockAvailability {
  Yes
  No
}

model Category {
  id          String  @id @default(cuid()) @db.Text
  name        String
  banner      String?
  description String?
  status      Status  @default(Enabled)

  metadata   CatagoryMetadata? @relation(fields: [metadataId], references: [id])
  metadataId String?           @db.Text

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  @@index([id])
  @@map("categories")
}

model CatagoryMetadata {
  id String @id @default(cuid()) @db.Text

  metaSeoTitle    String?
  metaSeoKeyword  String?
  metaDescription String?

  Category Category[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  @@index([id])
  @@map("category_metadatas")
}

model Collection {
  id          Int     @id @default(autoincrement()) @db.Integer
  name        String
  code        String
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  @@map("collections")
}

model User {
  id   Int    @id @unique @default(autoincrement()) @db.Integer
  code String @unique @db.Char(16)

  firstName      String
  lastName       String
  email          String @unique
  passwordHashed String

  role Role

  @@index([id, code])
  @@map("users")
}

enum Role {
  Admin
  Employee
  Customer
}

model Coupon {
  id             Int          @id @default(autoincrement()) @db.Integer
  code           String       @db.Char(24)
  discountType   DiscountType
  discountAmount Int          @db.Integer
  description    String?
  startDate      DateTime     @default(now())
  endDate        DateTime     @default(now())
  status         Status

  isFreeshipping Boolean? @default(false)
  usedTimes      Int?     @default(0)

  @@map("coupons")
}

enum DiscountType {
  Percent
  Price
}

model Order {
  id          Int    @id @default(autoincrement()) @db.Integer
  orderNumber String @unique @db.Char(16)

  customerId    String  @unique
  customerEmail String
  customerPhone String?
  customerNote  String?

  shipmentStatus OrderShipmentStatus @default(Unfullfilled)
  paymentStatus  OrderPaymentStatus  @default(Unpaid)

  orderCouponCode     String
  orderDiscount       Int    @default(0)
  orderTotalAmount    Int    @default(0)
  orderSubTotalAmount Int    @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  products OrderProduct[]

  @@map("orders")
}

enum OrderShipmentStatus {
  Unfullfilled
  Fullfilled
}

enum OrderPaymentStatus {
  Unpaid
  Paid
  Refunded
}

model OrderProduct {
  id Int @id @default(autoincrement()) @db.Integer

  product   Product @relation(fields: [productId], references: [id])
  productId String  @db.Text()

  order   Order @relation(fields: [orderId], references: [id])
  orderId Int   @db.Integer

  productAmount Int @default(1)

  @@map("order_products")
}
